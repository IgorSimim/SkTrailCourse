@{
    ViewData["Title"] = "ZoopIA";
}

<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="/img/logo.png" />
    <title>@ViewData["Title"]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet" />
</head>

<body>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-12 col-lg-10 col-xl-8">
                <div class="terminal-container">

                    <!-- HEADER -->
                    <div class="terminal-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex align-items-center">
                                <img src="/img/logo.png" alt="Logo ZoopIA">
                                <div>
                                    <h3 class="mb-1">ZoopIA</h3>
                                    <p>Plataforma de rastreamento e an√°lise de disputas de cobran√ßa</p>
                                </div>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-header-control me-2" onclick="clearTerminal()">
                                    <span class="icon-text">‚ü≥</span> Limpar
                                </button>
                                <button class="btn btn-sm btn-header-control" data-bs-toggle="modal"
                                    data-bs-target="#helpModal">
                                    <span class="icon-text">i</span> Ajuda
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- TERMINAL OUTPUT -->
                    <div class="terminal-body" id="terminalOutput">
                        <div id="outputText"></div>
                    </div>

                    <!-- INPUT CONTAINER -->
                    <div class="terminal-input-container">
                        <div id="normalInput">
                            <div class="input-group">
                                <span class="input-group-text">üí¨</span>
                                <input type="text" class="form-control terminal-input" id="commandInput"
                                    placeholder="Descreva a cobran√ßa que n√£o reconhece (ex: 'Cobran√ßa de 39,90 da FitEasy')..."
                                    autocomplete="off" autofocus>
                                <button class="btn btn-terminal" id="sendButton" onclick="sendCommand()">
                                    <span id="sendText">Enviar</span>
                                    <span id="loadingSpinner" class="spinner-border spinner-border-sm d-none"
                                        role="status"></span>
                                </button>
                            </div>
                        </div>

                        <div id="cpfInput" class="mt-3" style="display:none">
                            <div class="input-group">
                                <span class="input-group-text">üë§</span>
                                <input type="text" class="form-control terminal-input" id="customerCpfInput"
                                    placeholder="Digite seu CPF (apenas n√∫meros)" autocomplete="off">
                                <button class="btn btn-terminal" onclick="searchBoletos()">
                                    <span>Consultar Boletos</span>
                                </button>
                                <button class="btn btn-secondary" onclick="cancelCpfInput()">Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE AJUDA -->
    <div class="modal fade" id="helpModal" tabindex="-1" aria-labelledby="helpModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg mx-auto">
            <div class="modal-content text-white">
                <div class="modal-header border-0">
                    <h4 class="modal-title fw-bold" id="helpModalLabel">üí° Ajuda - comandos</h4>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                        aria-label="Close"></button>
                </div>

                <div class="modal-body help-modal-body">
                    <!-- Comprehensive help content: commands, examples and flows -->

                    <h5>O que este sistema faz</h5>
                    <ul>
                        <li>Detecta cobran√ßas suspeitas e sugere a√ß√µes (consulta, reclama√ß√£o, an√°lise manual).</li>
                        <li>Consulta boletos por CPF (fluxo interativo: pede CPF).</li>
                        <li>Registra reclama√ß√µes (disputas) com extra√ß√£o de estabelecimento, valor e resumo autom√°tico.</li>
                        <li>Permite atualizar, editar, listar e excluir disputas por ID.</li>
                        <li>Suporta confirma√ß√µes em linguagem natural (ex.: quando "Zoop" √© amb√≠guo, pergunta se quer consultar ou reclamar).</li>
                    </ul>

                    <h5>Comandos r√°pidos</h5>
                    <div class="command-card">
                        <span class="command-badge bg-primary">consultar</span>
                        <p class="command-desc">Inicia fluxo de consulta (sugerido quando mencionar boleto/cobran√ßa). O sistema pedir√° CPF.</p>
                    </div>

                    <div class="command-card">
                        <span class="command-badge bg-warning">reclamar / quero reclamar</span>
                        <p class="command-desc">Abre fluxo de reclama√ß√£o. Descreva a cobran√ßa indevida com o m√°ximo de detalhes.</p>
                    </div>

                    <div class="command-card">
                        <span class="command-badge bg-secondary">mostrar &lt;ID&gt;</span>
                        <p class="command-desc">Mostra detalhes de uma disputa pelo ID (ex: "mostrar ABC123").</p>
                    </div>

                    <div class="command-card">
                        <span class="command-badge bg-success">atualizar &lt;ID&gt; para resolvida</span>
                        <p class="command-desc">Marca uma disputa como resolvida (ex: "atualizar ABC123 para resolvida").</p>
                    </div>

                    <div class="command-card">
                        <span class="command-badge bg-danger">excluir &lt;ID&gt;</span>
                        <p class="command-desc">Remove uma disputa (ex: "excluir ABC123").</p>
                    </div>

                    <hr />

                    <h5>Exemplos de mensagens naturais</h5>
                    <ul>
                        <li>"Verifiquei uma cobran√ßa de R$ 39,90 da Zoop no meu boleto" ‚Äî o sistema detecta Zoop/ambiguidade e pode pedir confirma√ß√£o.</li>
                        <li>"N√£o reconhe√ßo uma compra de 150 reais da Netflix" ‚Äî inicia reclama√ß√£o autom√°tica.</li>
                        <li>"Achei um d√©bito estranho no meu extrato de 12/09 de R$ 20,00" ‚Äî o sistema extrai valor e data quando poss√≠vel.</li>
                        <li>"Quero reclamar de uma cobran√ßa indevida" ‚Äî pede detalhes se necess√°rio.</li>
                        <li>"Tem uma cobrana da Zoop no meu boleto" ‚Äî se amb√≠guo, o sistema pergunta: CONSULTAR ou RECLAMAR?</li>
                    </ul>

                    <h5>Fluxos interativos</h5>
                    <ol>
                        <li>Consulta de boletos: digite algo com "boleto" ‚Üí responda √† pergunta de confirma√ß√£o (se pedir) ‚Üí informe CPF quando solicitado ‚Üí veja resultados.</li>
                        <li>Reclama√ß√£o a partir de uma consulta: ap√≥s ver resultados, diga "quero reclamar" e o sistema usar√° o hist√≥rico da conversa para criar a reclama√ß√£o consistente (ex: "zoop no boleto" + sua mensagem de reclama√ß√£o).</li>
                        <li>Quando o sistema n√£o identificar o estabelecimento, ele solicitar√°: "Qual estabelecimento/empresa voc√™ quer reclamar?" ‚Äî responda apenas com o nome (ex: "Netflix", "Loja X").</li>
                    </ol>

                    <h5>Boas pr√°ticas e dicas</h5>
                    <ul>
                        <li>Inclua valor, data e nome do estabelecimento quando souber ‚Äî isso melhora a extra√ß√£o autom√°tica.</li>
                        <li>Se n√£o souber o estabelecimento, aguarde a pergunta do sistema e responda apenas com o nome.</li>
                        <li>O sistema preserva o hist√≥rico recente; frasese curtas como "quero reclamar" logo ap√≥s uma consulta ser√£o entendidas no contexto.</li>
                        <li>Evite usar palavr√µes no nome do estabelecimento ‚Äî nomes ofensivos s√£o rejeitados.</li>
                    </ul>

                    <p class="command-tip">
                        üí° Dica r√°pida: tente frases naturais ‚Äî o sistema entende linguagem coloquial (ex: "n√£o reconhe√ßo essa cobran√ßa da Zoop") e faz follow-up automaticamente.
                    </p>
                </div>

                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-terminal rounded px-4 py-2"
                        data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/terminal.js"></script>
</body>

</html>